<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Context I recently took the excellent &amp;ldquo;Architecture 1001: x86-64 Assembly&amp;rdquo; course offered by Xeno Kovah on OpenSecurityTraining2 to consolidate my knowledge of x86-64 assembly. The final assignment consists in solving the &amp;ldquo;Bomb Lab&amp;rdquo;.
Although the course suggests to use gdb or WinDbg, I decided to do it differently and use Cutter with the following constraints:
 Not using debug symbols - this is something Xeno actually recommends if one has some reverse-engineering experience, or want extra challenge Perform a pure static analysis - using gdb/gef would be much smarter here, but I really wanted to practice static analysis Not using rz-ghidra or any decompiler since that would defeat the whole point of the exercise  I used Cutter Version 2." />
<meta name="keywords" content=", reverse-engineering, assembly, x86-64, cutter, write-up" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://vthiery.github.io/posts/re-bomb-lab/" />


    <title>
        
            Reverse Engineering the &#34;Bomb Lab&#34; with Cutter :: Vincent Thiery 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Reverse Engineering the &#34;Bomb Lab&#34; with Cutter">
<meta itemprop="description" content="Context I recently took the excellent &ldquo;Architecture 1001: x86-64 Assembly&rdquo; course offered by Xeno Kovah on OpenSecurityTraining2 to consolidate my knowledge of x86-64 assembly. The final assignment consists in solving the &ldquo;Bomb Lab&rdquo;.
Although the course suggests to use gdb or WinDbg, I decided to do it differently and use Cutter with the following constraints:
 Not using debug symbols - this is something Xeno actually recommends if one has some reverse-engineering experience, or want extra challenge Perform a pure static analysis - using gdb/gef would be much smarter here, but I really wanted to practice static analysis Not using rz-ghidra or any decompiler since that would defeat the whole point of the exercise  I used Cutter Version 2."><meta itemprop="datePublished" content="2023-07-12T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-07-12T00:00:00+00:00" />
<meta itemprop="wordCount" content="6397">
<meta itemprop="keywords" content="reverse-engineering,assembly,x86-64,cutter,write-up," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reverse Engineering the &#34;Bomb Lab&#34; with Cutter"/>
<meta name="twitter:description" content="Context I recently took the excellent &ldquo;Architecture 1001: x86-64 Assembly&rdquo; course offered by Xeno Kovah on OpenSecurityTraining2 to consolidate my knowledge of x86-64 assembly. The final assignment consists in solving the &ldquo;Bomb Lab&rdquo;.
Although the course suggests to use gdb or WinDbg, I decided to do it differently and use Cutter with the following constraints:
 Not using debug symbols - this is something Xeno actually recommends if one has some reverse-engineering experience, or want extra challenge Perform a pure static analysis - using gdb/gef would be much smarter here, but I really wanted to practice static analysis Not using rz-ghidra or any decompiler since that would defeat the whole point of the exercise  I used Cutter Version 2."/>







    <meta property="article:published_time" content="2023-07-12 00:00:00 &#43;0000 UTC" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text">/home/vthiery</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/posts/">Posts</a></li><li><a href="/notes/">Notes</a></li><li><a href="/cv/">CV</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        31 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://vthiery.github.io/posts/re-bomb-lab/">Reverse Engineering the &ldquo;Bomb Lab&rdquo; with Cutter</a>
      </h1>

      

      

      

      <div class="post-content">
        <h2 id="context">Context</h2>
<p>I recently took the excellent <a href="https://p.ost2.fyi/courses/course-v1:OpenSecurityTraining2+Arch1001_x86-64_Asm+2021_v1/course/">&ldquo;Architecture 1001: x86-64 Assembly&rdquo;</a> course offered by Xeno Kovah on <a href="https://p.ost2.fyi/courses/">OpenSecurityTraining2</a> to consolidate my knowledge of x86-64 assembly.
The final assignment consists in solving the <a href="https://gitlab.com/opensecuritytraining/arch1001_x86-64_asm_code_for_class">&ldquo;Bomb Lab&rdquo;</a>.</p>
<p>Although the course suggests to use <a href="https://sourceware.org/gdb/current/onlinedocs/">gdb</a> or <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/">WinDbg</a>, I decided to do it differently and use <a href="https://cutter.re/">Cutter</a> with the following constraints:</p>
<ul>
<li>Not using debug symbols - this is something Xeno actually recommends if one has some reverse-engineering experience, or want extra challenge</li>
<li>Perform a pure static analysis - using <a href="https://hugsy.github.io/gef/">gdb/gef</a> would be much smarter here, but I really wanted to practice static analysis</li>
<li>Not using <a href="https://github.com/rizinorg/rz-ghidra">rz-ghidra</a> or any decompiler since that would defeat the whole point of the exercise</li>
</ul>
<p>I used Cutter Version 2.2.1 on Debian 11 and stuck to Intel syntax. Also, even though I have been using Cutter&rsquo;s &ldquo;Graph&rdquo; view a lot, only linear disassembly code snippets will be used to illustrate my analysis.</p>
<h2 id="analysis">Analysis</h2>
<h3 id="strings">strings</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ strings -n8 bomb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>That<span style="color:#e6db74">&#39;s number 2.  Keep going!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Halfway there!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Good work!  On to the next...
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Welcome to my fiendish little bomb. You have 6 phases with
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">which to blow yourself up. Have a nice day!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Phase 1 defused. How about the next one?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">So you got that one.  Try this one.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">I am just a renegade hockey mom.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Wow! You&#39;</span>ve defused the secret stage!
</span></span><span style="display:flex;"><span>So you think you can stop the bomb with ctrl-c, <span style="color:#66d9ef">do</span> you?
</span></span><span style="display:flex;"><span>Curses, you<span style="color:#e6db74">&#39;ve found the secret phase!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">But finding it and solving it are quite different...
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Congratulations! You&#39;</span>ve defused the bomb!
</span></span><span style="display:flex;"><span>Invalid phase%s
</span></span><span style="display:flex;"><span>The bomb has blown up.
</span></span><span style="display:flex;"><span>%d %d %d %d %d %d
</span></span></code></pre></div><p>Some useful information here already:</p>
<ul>
<li>6 &ldquo;phases&rdquo; to defuse</li>
<li>&ldquo;I am just a renegade hockey mom.&rdquo; is likely the solution of one of the first phases</li>
<li>there is a &ldquo;secret phase&rdquo;</li>
</ul>
<p>Reducing the string min-len might help finding other hints, but let&rsquo;s jump right into some assembly already!</p>
<h3 id="main">main</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">int</span> <span style="color:#66d9ef">main</span> (<span style="color:#66d9ef">int</span> <span style="color:#66d9ef">argc</span>, <span style="color:#66d9ef">char</span> **<span style="color:#66d9ef">argv</span>, <span style="color:#66d9ef">char</span> **<span style="color:#66d9ef">envp</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg unsigned long argc @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg char **filename @ rsi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001449</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000144d</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000144e</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">1</span>         <span style="color:#75715e">; argc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001451</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x154f</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001457</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rsi</span>       <span style="color:#75715e">; argv
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000145a</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">2</span>         <span style="color:#75715e">; argc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000145d</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1584</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001463</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>] <span style="color:#75715e">; const char *filename
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001467</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">data.00003004</span> <span style="color:#75715e">; 0x3004 ; const char *mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000146e</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fopen</span>         <span style="color:#75715e">; sym.imp.fopen ; FILE *fopen(const char *filename, const char *mode)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001473</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">data.00005698</span>, <span style="color:#66d9ef">rax</span> <span style="color:#75715e">; 0x5698
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000147a</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000147d</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1562</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001483</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001b31</span>  <span style="color:#75715e">; fcn.00001b31
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001488</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Welcome_to_my_fiendish_little_bomb._You_have_6_phases_with</span> <span style="color:#75715e">; 0x3088 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000148f</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001494</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.which_to_blow_yourself_up._Have_a_nice_day</span> <span style="color:#75715e">; 0x30c8 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000149b</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014a0</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001c56</span>  <span style="color:#75715e">; fcn.00001c56
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014a5</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>       <span style="color:#75715e">; int64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014a8</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.000015a7</span>  <span style="color:#75715e">; fcn.000015a7
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014ad</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001d9e</span>  <span style="color:#75715e">; fcn.00001d9e
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014b2</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Phase_1_defused._How_about_the_next_one</span> <span style="color:#75715e">; 0x30f8 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014b9</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014be</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001c56</span>  <span style="color:#75715e">; fcn.00001c56
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014c3</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000014c6</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.000015cb</span>  <span style="color:#75715e">; fcn.000015cb
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014cb</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001d9e</span>  <span style="color:#75715e">; fcn.00001d9e
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014d0</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.That_s_number_2.__Keep_going</span> <span style="color:#75715e">; 0x303d ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014d7</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014dc</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001c56</span>  <span style="color:#75715e">; fcn.00001c56
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014e1</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>       <span style="color:#75715e">; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014e4</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001639</span>  <span style="color:#75715e">; fcn.00001639
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014e9</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001d9e</span>  <span style="color:#75715e">; fcn.00001d9e
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014ee</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Halfway_there</span> <span style="color:#75715e">; 0x305b ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014f5</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014fa</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001c56</span>  <span style="color:#75715e">; fcn.00001c56
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000014ff</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>       <span style="color:#75715e">; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001502</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.0000174b</span>  <span style="color:#75715e">; fcn.0000174b
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001507</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001d9e</span>  <span style="color:#75715e">; fcn.00001d9e
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000150c</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.So_you_got_that_one.__Try_this_one.</span> <span style="color:#75715e">; 0x3128 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001513</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001518</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001c56</span>  <span style="color:#75715e">; fcn.00001c56
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000151d</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>       <span style="color:#75715e">; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001520</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.000017c4</span>  <span style="color:#75715e">; fcn.000017c4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001525</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001d9e</span>  <span style="color:#75715e">; fcn.00001d9e
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000152a</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Good_work___On_to_the_next...</span> <span style="color:#75715e">; 0x306a ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001531</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001536</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001c56</span>  <span style="color:#75715e">; fcn.00001c56
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000153b</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000153e</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.0000185b</span>  <span style="color:#75715e">; fcn.0000185b
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001543</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001d9e</span>  <span style="color:#75715e">; fcn.00001d9e
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001548</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000154d</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000154e</span>      <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>Quick notes:</p>
<ul>
<li>there is an early <code>call fcn.00001b31</code> instruction</li>
<li>multiple triplets of instructions:
<ul>
<li><code>call fcn.00001c56</code></li>
<li><code>call fcn.0000????</code> , likely the phases</li>
<li><code>call fcn.00001d9e</code></li>
</ul>
</li>
</ul>
<h4 id="interrupt-signal">Interrupt signal</h4>
<p><code>fcn.00001b31</code> calls the <code>signal</code> function to handle interrupts:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.00001b31</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b31</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b35</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b39</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">data.00001a21</span> <span style="color:#75715e">; 0x1a21 ; void *func
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b40</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">2</span>         <span style="color:#75715e">; int sig
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b45</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">signal</span>        <span style="color:#75715e">; sym.imp.signal ; void signal(int sig, void *func)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b4a</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b4e</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b4f</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b53</span>      <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>with the following handler to troll users:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#75715e">;-- data.00001a21:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a21</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a25</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a26</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a27</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a2b</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.So_you_think_you_can_stop_the_bomb_with_ctrl_c__do_you</span> <span style="color:#75715e">; 0x3200
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a32</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a37</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a3c</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">sleep</span>         <span style="color:#75715e">; sym.imp.sleep ; int sleep(int s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a41</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.Well...</span> <span style="color:#75715e">; 0x32c2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a48</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a4d</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a52</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__printf_chk</span>  <span style="color:#75715e">; sym.imp.__printf_chk
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a57</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">stdout</span> <span style="color:#75715e">; 0x5660
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a5e</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fflush</span>        <span style="color:#75715e">; sym.imp.fflush ; int fflush(FILE *stream)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a63</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a68</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">sleep</span>         <span style="color:#75715e">; sym.imp.sleep ; int sleep(int s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a6d</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.OK._</span>: <span style="color:#75715e">; 0x32ca
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a74</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a79</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">0x10</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a7e</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">exit</span>          <span style="color:#75715e">; sym.imp.exit ; void exit(int status)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a83</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a87</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a88</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a89</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a8d</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">rdi</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a90</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.Invalid_phase_s</span> <span style="color:#75715e">; 0x32d2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a97</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a9c</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001aa1</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__printf_chk</span>  <span style="color:#75715e">; sym.imp.__printf_chk
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001aa6</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001aab</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">exit</span>          <span style="color:#75715e">; sym.imp.exit ; void exit(int status)
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ ./bomb             
</span></span><span style="display:flex;"><span>Welcome to my fiendish little bomb. You have <span style="color:#ae81ff">6</span> phases with
</span></span><span style="display:flex;"><span>which to blow yourself up. Have a nice day!
</span></span><span style="display:flex;"><span>^CSo you think you can stop the bomb with ctrl-c, <span style="color:#66d9ef">do</span> you?
</span></span><span style="display:flex;"><span>Well...OK. :-<span style="color:#f92672">)</span>
</span></span></code></pre></div><h4 id="reading-inputs">Reading inputs</h4>
<p>Looking rapidly into <code>fcn.00001c56</code> (and functions called inside), we see <code>stdin</code>, <code>str.Error:_Input_line_too_long</code>,… so it looks like it reads user inputs. Given that it’s called repeatedly in <code>main</code>, we can safely assume it is the case.</p>
<p>It also keeps count of the number of answers we provide using <code>data.00005690</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c6d</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">esi</span>, <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">data.00005690</span> <span style="color:#75715e">; 0x5690
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ccb</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">esi</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001cce</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">data.00005690</span>, <span style="color:#66d9ef">esi</span> <span style="color:#75715e">; 0x5690
</span></span></span></code></pre></div><p>Let’s simply rename it to <code>read_line</code> and go hunt for more interesting code.</p>
<h4 id="check-completion">Check completion</h4>
<p><code>fcn.00001d9e</code> is called after each phase</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.00001d9e</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int var_78h @ stack - 0x78
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int var_74h @ stack - 0x74
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_70h @ stack - 0x70
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_18h @ stack - 0x18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001d9e</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001da2</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x78</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001da6</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001daf</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001db4</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001db6</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">data.00005690</span>, <span style="color:#ae81ff">6</span> <span style="color:#75715e">; 0x5690
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001dbd</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1dd4</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dbf</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dc4</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dcd</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1e42</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dcf</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x78</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dd3</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dd4</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, [<span style="color:#66d9ef">var_74h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dd9</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, [<span style="color:#66d9ef">var_78h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dde</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">r8</span>, [<span style="color:#66d9ef">var_70h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001de3</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.d__d__s</span> <span style="color:#75715e">; 0x3359 ; const char *format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001dea</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">data.00005790</span> <span style="color:#75715e">; 0x5790 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001df1</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__isoc99_sscanf</span> <span style="color:#75715e">; sym.imp.__isoc99_sscanf ; int sscanf(const char *s, const char *format, va_list args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001df6</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">3</span>         <span style="color:#75715e">; expect 2 numbers and a string
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001df9</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1e09</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dfb</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Congratulations__You_ve_defused_the_bomb</span> <span style="color:#75715e">; 0x3298 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e02</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e07</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1dbf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e09</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, [<span style="color:#66d9ef">var_70h</span>] <span style="color:#75715e">; int64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e0e</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.DrEvil</span> <span style="color:#75715e">; 0x3362 ; int64_t arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e15</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">strings_not_equal</span> <span style="color:#75715e">; strings_not_equal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e1a</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e1c</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1dfb</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e1e</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Curses__you_ve_found_the_secret_phase</span> <span style="color:#75715e">; 0x3238 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e25</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e2a</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.But_finding_it_and_solving_it_are_quite_different...</span> <span style="color:#75715e">; 0x3260 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e31</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e36</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e3b</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.000019c4</span>  <span style="color:#75715e">; fcn.000019c4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e40</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1dfb</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e42</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__stack_chk_fail</span> <span style="color:#75715e">; sym.imp.__stack_chk_fail ; void __stack_chk_fail(void)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e47</span>      <span style="color:#66d9ef">endbr64</span>
</span></span></code></pre></div><p>This function uses <code>data.00005690</code> that <code>read_line</code> uses to count the number of answers we provide and checks whether we’ve reached 7 before congratulating us with <code>“Congratulations! You've defused the bomb!”</code>.</p>
<p>There are other intriguing bits such as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dd4</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, [<span style="color:#66d9ef">var_74h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dd9</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, [<span style="color:#66d9ef">var_78h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dde</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">r8</span>, [<span style="color:#66d9ef">var_70h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001de3</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.d__d__s</span> <span style="color:#75715e">; 0x3359 ; const char *format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001dea</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">data.00005790</span> <span style="color:#75715e">; 0x5790 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001df1</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__isoc99_sscanf</span> <span style="color:#75715e">; sym.imp.__isoc99_sscanf ; int sscanf(const char *s, const char *format, va_list args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001df6</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e09</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, [<span style="color:#66d9ef">var_70h</span>] <span style="color:#75715e">; int64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e0e</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.DrEvil</span> <span style="color:#75715e">; 0x3362 ; int64_t arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e15</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">strings_not_equal</span> <span style="color:#75715e">; strings_not_equal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e1a</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e1c</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1dfb</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e1e</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Curses__you_ve_found_the_secret_phase</span> <span style="color:#75715e">; 0x3238 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e25</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e2a</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.But_finding_it_and_solving_it_are_quite_different...</span> <span style="color:#75715e">; 0x3260 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e31</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e36</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e3b</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.000019c4</span>  <span style="color:#75715e">; fcn.000019c4
</span></span></span></code></pre></div><p>Let’s rename this function <code>check_completion</code> and leave the secret phase aside for the time being.</p>
<h3 id="phase-1">Phase 1</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.000015a7</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015a7</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015ab</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015af</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.I_am_just_a_renegade_hockey_mom.</span> <span style="color:#75715e">; 0x3150 ; int64_t arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015b6</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001ad1</span>  <span style="color:#75715e">; fcn.00001ad1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015bb</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015bd</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x15c4</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015bf</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015c3</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015c4</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001be5</span>  <span style="color:#75715e">; fcn.00001be5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015c9</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x15bf</span>         <span style="color:#75715e">; fcn.000015a7+0x18
</span></span></span></code></pre></div><p>This is “phase 1”, so let’s rename it to <code>phase_1</code>. I will also take this opportunity to rename the other “phase” functions.</p>
<p>We see a string and a <code>test</code> followed by a <code>jne</code> instruction, so <code>fcn.00001ad1</code> is likely a string comparison function. If <code>eax</code> is not 0, then we jump to <code>0x000015c4</code> to call <code>fcn.00001be5</code> which might be our detonation function.</p>
<p>And indeed, it is</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.000015a7</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001be5</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001be9</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001bea</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001beb</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001bef</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.BOOM</span>  <span style="color:#75715e">; 0x32e3 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001bf6</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001bfb</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.The_bomb_has_blown_up.</span> <span style="color:#75715e">; 0x32ec ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c02</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c07</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">8</span>         <span style="color:#75715e">; int status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c0c</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">exit</span>          <span style="color:#75715e">; sym.imp.exit ; void exit(int status)
</span></span></span></code></pre></div><p>Let’s rename it to <code>detonate</code>.</p>
<p>Now, the logic dictates that, if <code>fcn.00001ad1</code> is really a string comparison function, it shall return 0 if the strings are equal, and 1 if they are not. Let’s confirm that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.00001ad1</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>, <span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg2</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg2 @ rsi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ad1</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad5</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">r12</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad7</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad8</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad9</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rdi</span>       <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001adc</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsi</span>       <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001adf</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001ab0</span>  <span style="color:#75715e">; fcn.00001ab0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ae4</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r12d</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ae7</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rbp</span>       <span style="color:#75715e">; uint64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001aea</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001ab0</span>  <span style="color:#75715e">; fcn.00001ab0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001aef</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edx</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001af1</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001af6</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">r12d</span>, <span style="color:#66d9ef">edx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001af9</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1b2c</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001afb</span>      <span style="color:#66d9ef">movzx</span> <span style="color:#66d9ef">edx</span>, <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">rbx</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001afe</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">dl</span>, <span style="color:#66d9ef">dl</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b00</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1b20</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b02</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b07</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">rbp</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span>], <span style="color:#66d9ef">dl</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b0b</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1b27</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b0d</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b11</span>      <span style="color:#66d9ef">movzx</span> <span style="color:#66d9ef">edx</span>, <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b15</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">dl</span>, <span style="color:#66d9ef">dl</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b17</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1b07</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b19</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b1e</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1b2c</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b20</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b25</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1b2c</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b27</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b2c</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b2d</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b2e</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">r12</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b30</span>      <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>The function <code>fcn.00001ab0</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.00001ab0</span> (<span style="color:#66d9ef">uint64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg uint64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ab0</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ab4</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">rdi</span>], <span style="color:#ae81ff">0</span>  <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ab7</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1acb</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ab9</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001abe</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#ae81ff">1</span>         <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ac2</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ac5</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">rdi</span>], <span style="color:#ae81ff">0</span>  <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ac8</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1abe</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001aca</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001acb</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad0</span>      <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>is called twice and computes the length of the input, so let’s rename to <code>length</code>.</p>
<p>After a quick analysis of <code>fcn.00001ad1</code>, we can confirm that it compares strings and indeed returns 0 if equal, and 1 if not, so let’s rename it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">strings_not_equal</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>, <span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg2</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg2 @ rsi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ad1</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad5</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">r12</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad7</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad8</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ad9</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rdi</span>       <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001adc</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsi</span>       <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001adf</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">length</span>        <span style="color:#75715e">; compute length of arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ae4</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r12d</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001ae7</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rbp</span>       <span style="color:#75715e">; uint64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001aea</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">length</span>        <span style="color:#75715e">; compute length of arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001aef</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edx</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001af1</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001af6</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">r12d</span>, <span style="color:#66d9ef">edx</span>      <span style="color:#75715e">; compare lengths of arguments
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001af9</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1b2c</span>         <span style="color:#75715e">; return 1 if length do not match
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001afb</span>      <span style="color:#66d9ef">movzx</span> <span style="color:#66d9ef">edx</span>, <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">rbx</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001afe</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">dl</span>, <span style="color:#66d9ef">dl</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b00</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1b20</span>          <span style="color:#75715e">; if arg1 is null byte, strings match, return 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b02</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b07</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">rbp</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span>], <span style="color:#66d9ef">dl</span> <span style="color:#75715e">; compare strings byte after byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b0b</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1b27</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b0d</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b11</span>      <span style="color:#66d9ef">movzx</span> <span style="color:#66d9ef">edx</span>, <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b15</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">dl</span>, <span style="color:#66d9ef">dl</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b17</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1b07</span>         <span style="color:#75715e">; loop as long as dl is not null byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b19</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>         <span style="color:#75715e">; return 0 if strings match
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b1e</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1b2c</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b20</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b25</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1b2c</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b27</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b2c</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b2d</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b2e</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">r12</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b30</span>      <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>Now that we have understood all the functions in <code>phase_1</code> the code is crystal clear:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">phase_1</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015a7</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015ab</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015af</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.I_am_just_a_renegade_hockey_mom.</span> <span style="color:#75715e">; 0x3150 ; int64_t arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015b6</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">strings_not_equal</span> <span style="color:#75715e">; strings_not_equal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015bb</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>      <span style="color:#75715e">; set ZF to 1 if eax == 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015bd</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x15c4</span>         <span style="color:#75715e">; jumps if ZF is not set
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015bf</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015c3</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015c4</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015c9</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x15bf</span>         <span style="color:#75715e">; phase_1+0x18
</span></span></span></code></pre></div><p>The answer to pass phase 1 is the string that we saw running <code>strings</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#75715e">;-- str.I_am_just_a_renegade_hockey_mom.:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00003150</span>          <span style="color:#66d9ef">.string</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">I</span> <span style="color:#66d9ef">am</span> <span style="color:#66d9ef">just</span> <span style="color:#66d9ef">a</span> <span style="color:#66d9ef">renegade</span> <span style="color:#66d9ef">hockey</span> <span style="color:#66d9ef">mom.</span><span style="color:#960050;background-color:#1e0010">&#34;</span> <span style="color:#75715e">; len=33
</span></span></span></code></pre></div><h3 id="phase-2">Phase 2</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">phase_2</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_24h @ stack - 0x24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_20h @ stack - 0x20
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015cb</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015cf</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015d0</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015d1</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x28</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015d5</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015de</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015e3</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015e5</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">rsp</span>       <span style="color:#75715e">; int arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015e8</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001c11</span>  <span style="color:#75715e">; fcn.00001c11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015ed</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015f1</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x15fd</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015f3</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015f6</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rbp</span>, [<span style="color:#66d9ef">var_24h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015fb</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1612</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015fd</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001602</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x15f3</span>         <span style="color:#75715e">; phase_2+0x28
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001604</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001609</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000160d</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001610</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x161d</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001612</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rbx</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001614</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001616</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">4</span>], <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001619</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1609</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000161b</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1604</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000161d</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001622</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000162b</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1634</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000162d</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x28</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001631</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001632</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001633</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001634</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__stack_chk_fail</span> <span style="color:#75715e">; sym.imp.__stack_chk_fail ; void __stack_chk_fail(void)
</span></span></span></code></pre></div><p>There is only one function we don’t know here: <code>fcn.00001c11</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.00001c11</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> *<span style="color:#66d9ef">s</span>, <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">arg2</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg const char *s @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int arg2 @ rsi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c11</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c15</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c19</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">rsi</span>       <span style="color:#75715e">; arg2 ; results of sscanf on the stack
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c1c</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">4</span>] <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c20</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0x14</span>] <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c24</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c25</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0x10</span>] <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c29</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c2a</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">r9</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0xc</span>] <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c2e</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">r8</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>]  <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c32</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.d__d__d__d__d__d</span> <span style="color:#75715e">; 0x3303 ; const char *format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c39</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c3e</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__isoc99_sscanf</span> <span style="color:#75715e">; sym.imp.__isoc99_sscanf ; int sscanf(const char *s, const char *format, va_list args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c43</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x10</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c47</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c4a</span>      <span style="color:#66d9ef">jle</span> <span style="color:#ae81ff">0x1c51</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c4c</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c50</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c51</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#75715e">;-- str.d__d__d__d__d__d:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00003303</span>          <span style="color:#66d9ef">.string</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>%d %d %d %d %d %d<span style="color:#960050;background-color:#1e0010">&#34;</span> <span style="color:#75715e">; len=18
</span></span></span></code></pre></div><p><code>fcn.00001c11</code> reads the user input expecting 6 numbers, and calls <code>detonate</code> if provided with less. Let’s rename to <code>read_6_numbers</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">read_6_numbers</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> *<span style="color:#66d9ef">s</span>, <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">arg2</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg const char *s @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int arg2 @ rsi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c11</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c15</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c19</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">rsi</span>       <span style="color:#75715e">; arg2 ; results of sscanf on the stack
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c1c</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">4</span>] <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c20</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0x14</span>] <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c24</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c25</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0x10</span>] <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c29</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c2a</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">r9</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0xc</span>] <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c2e</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">r8</span>, [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>]  <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c32</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.d__d__d__d__d__d</span> <span style="color:#75715e">; 0x3303 ; const char *format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c39</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c3e</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__isoc99_sscanf</span> <span style="color:#75715e">; sym.imp.__isoc99_sscanf ; int sscanf(const char *s, const char *format, va_list args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c43</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x10</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c47</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">5</span>         <span style="color:#75715e">; expect at least 6 numbers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c4a</span>      <span style="color:#66d9ef">jle</span> <span style="color:#ae81ff">0x1c51</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c4c</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c50</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c51</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span></code></pre></div><p>Now, let’s analyse <code>phase_2</code> itself:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">phase_2</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_24h @ stack - 0x24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_20h @ stack - 0x20
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015cb</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015cf</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015d0</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015d1</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x28</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015d5</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015de</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015e3</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015e5</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">rsp</span>       <span style="color:#75715e">; int arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015e8</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">read_6_numbers</span> <span style="color:#75715e">; read_6_numbers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015ed</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">1</span> <span style="color:#75715e">; first number must be 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000015f1</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x15fd</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015f3</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015f6</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rbp</span>, [<span style="color:#66d9ef">var_24h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015fb</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1612</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000015fd</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001602</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x15f3</span>         <span style="color:#75715e">; phase_2+0x28
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001604</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001609</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#ae81ff">4</span>         <span style="color:#75715e">; move to next number
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000160d</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001610</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x161d</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001612</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rbx</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001614</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>       <span style="color:#75715e">; double value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001616</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">4</span>], <span style="color:#66d9ef">eax</span> <span style="color:#75715e">; compare 2*current with next
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001619</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1609</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000161b</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1604</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000161d</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001622</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000162b</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1634</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000162d</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x28</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001631</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001632</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001633</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001634</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__stack_chk_fail</span> <span style="color:#75715e">; sym.imp.__stack_chk_fail ; void __stack_chk_fail(void)
</span></span></span></code></pre></div><p>Quick notes:</p>
<ul>
<li>on <code>0x000015ed</code>, we see that the first number must be equal to <code>1</code>.</li>
<li>starting at <code>0x00001612</code>, we loop over the numbers and check that the next one is twice the current value.</li>
</ul>
<p>Therefore, the solution to phase 2 is <code>1 2 4 8 16 32</code>.</p>
<h3 id="phase-3">Phase 3</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">phase_3</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> *<span style="color:#66d9ef">s</span>, <span style="color:#66d9ef">uint64_t</span> <span style="color:#66d9ef">arg_ch</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg const char *s @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_18h @ stack - 0x18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_14h @ stack - 0x14
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_10h @ stack - 0x10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg uint64_t arg_ch @ stack + 0xc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001639</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000163d</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x18</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001641</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000164a</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000164f</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001651</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, [<span style="color:#66d9ef">var_14h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001656</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">rsp</span>       <span style="color:#75715e">; va_list args
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001659</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">data.0000330f</span> <span style="color:#75715e">; 0x330f ; const char *format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001660</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__isoc99_sscanf</span> <span style="color:#75715e">; sym.imp.__isoc99_sscanf ; int sscanf(const char *s, const char *format, va_list args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001665</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001668</span>      <span style="color:#66d9ef">jle</span> <span style="color:#ae81ff">0x1688</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000166a</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000166e</span>      <span style="color:#66d9ef">ja</span> <span style="color:#66d9ef">case.default.switch.0x00001685</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001674</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001677</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">data.000031a0</span> <span style="color:#75715e">; 0x31a0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000167e</span>      <span style="color:#66d9ef">movsxd</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rdx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span>*<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001682</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">rdx</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- switch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001685</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#66d9ef">rax</span>            <span style="color:#75715e">; switch table (8 cases) at 0x31a0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001688</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#75715e">;-- data.0000330f:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000330f</span>          <span style="color:#66d9ef">.string</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>%d %d %d %d %d %d<span style="color:#960050;background-color:#1e0010">&#34;</span> <span style="color:#75715e">; len=18
</span></span></span></code></pre></div><p>Quick notes:</p>
<ul>
<li>we are dealing with a <code>switch</code> table</li>
<li>on <code>0x00001665</code> , we see a <code>cmp eax, 1</code> instruction followed by a <code>jle</code> instruction, so we need to input at least 2 numbers, even though the format provided to <code>sscanf</code> is <code>&quot;%d %d %d %d %d %d&quot;</code>.</li>
<li>if we input a number greater than <code>7</code>, we will jump to the default case, which detonates the bomb:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#75715e">;-- default:                       ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001704</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span></code></pre></div><p>Let’s have a look at the other cases:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#75715e">;-- case 0:                        ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000168f</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">data.00000274</span> <span style="color:#75715e">; 0x274
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001694</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">data.0000024c</span> <span style="color:#75715e">; 0x24c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001699</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">data.000002b0</span> <span style="color:#75715e">; 0x2b0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000169e</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0x7e</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016a1</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0x7e</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016a4</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0x7e</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016a7</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0x7e</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016aa</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0x7e</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016ad</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016b1</span>      <span style="color:#66d9ef">jg</span> <span style="color:#ae81ff">0x16b9</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016b3</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">arg_ch</span>], <span style="color:#66d9ef">eax</span> <span style="color:#75715e">; 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000016b7</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x16be</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016b9</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">explode_bomb</span>  <span style="color:#75715e">; sym.explode_bomb
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000016be</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016c3</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016cc</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1710</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016ce</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x18</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016d2</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- case 1:                        ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016d3</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016d8</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1694</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- case 2:                        ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016da</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016df</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1699</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- case 3:                        ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016e1</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016e6</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x169e</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- case 4:                        ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016e8</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016ed</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x16a1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- case 5:                        ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016ef</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016f4</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x16a4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- case 6:                        ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016f6</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016fb</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x16a7</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- case 7:                        ; from 0x1685
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000016fd</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001702</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x16aa</span>
</span></span></code></pre></div><p>We need to pick the first number, so that adding values from the cases allows to pass <code>cmp dword [arg_ch], eax</code> where <code>[arg_ch]</code> is set with the second number.</p>
<p>The solution to phase 3 is therefore: <code>0 602</code> since <code>602 = 0x274 - 0x24c + 0x2b0 - 0x7e + 0x7e - 0x7e + 0x7e - 0x7e</code>.</p>
<h3 id="phase-4">Phase 4</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">phase_4</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> *<span style="color:#66d9ef">s</span>, <span style="color:#66d9ef">uint64_t</span> <span style="color:#66d9ef">arg_ch</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg const char *s @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_18h @ stack - 0x18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_14h @ stack - 0x14
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_10h @ stack - 0x10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg uint64_t arg_ch @ stack + 0xc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000174b</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000174f</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x18</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001753</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000175c</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001761</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001763</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, [<span style="color:#66d9ef">var_14h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001768</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">rsp</span>       <span style="color:#75715e">; va_list args
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000176b</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">data.0000330f</span> <span style="color:#75715e">; 0x330f ; const char *format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001772</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__isoc99_sscanf</span> <span style="color:#75715e">; sym.imp.__isoc99_sscanf ; int sscanf(const char *s, const char *format, va_list args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001777</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000177a</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1782</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000177c</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0xe</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001780</span>      <span style="color:#66d9ef">jbe</span> <span style="color:#ae81ff">0x1787</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001782</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001787</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edx</span>, <span style="color:#ae81ff">0xe</span>       <span style="color:#75715e">; int64_t arg3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000178c</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">esi</span>, <span style="color:#ae81ff">0</span>         <span style="color:#75715e">; int64_t arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001791</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edi</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>] <span style="color:#75715e">; int64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001794</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001715</span>  <span style="color:#75715e">; fcn.00001715
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001799</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0xa</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000179c</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x17a5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000179e</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">arg_ch</span>], <span style="color:#ae81ff">0xa</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017a3</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x17aa</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017a5</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017aa</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017af</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017b8</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x17bf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017ba</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x18</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017be</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017bf</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__stack_chk_fail</span> <span style="color:#75715e">; sym.imp.__stack_chk_fail ; void __stack_chk_fail(void)
</span></span></span></code></pre></div><p>Quick notes:</p>
<ul>
<li><code>0x00001777</code> - it expects 2 numbers</li>
<li><code>0x0000177c</code> - the first number must be ≤<code>0xe</code></li>
<li><code>0x00001799</code> - the result of <code>fcn.00001715</code> must be <code>0xa</code></li>
<li><code>0x0000179e</code> - the second number is <code>10</code></li>
</ul>
<p>The only unknown function is <code>fcn.00001715</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.00001715</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>, <span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg2</span>, <span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg3</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg2 @ rsi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg3 @ rdx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001715</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001719</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000171a</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">edx</span>       <span style="color:#75715e">; arg3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000171c</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">esi</span>       <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000171e</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001720</span>      <span style="color:#66d9ef">shr</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#ae81ff">0x1f</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001723</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001725</span>      <span style="color:#66d9ef">sar</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001727</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#66d9ef">esi</span>       <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001729</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#66d9ef">edi</span>       <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000172b</span>      <span style="color:#66d9ef">jg</span> <span style="color:#ae81ff">0x1733</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000172d</span>      <span style="color:#66d9ef">jl</span> <span style="color:#ae81ff">0x173f</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000172f</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">ebx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001731</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001732</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001733</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">edx</span>, [<span style="color:#66d9ef">rbx</span> - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001736</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001715</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000173b</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000173d</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x172f</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000173f</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">esi</span>, [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001742</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001715</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001747</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001749</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x172f</span>
</span></span></code></pre></div><p>The function is recursive. Let’s write some C code to understand it better:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">mysterious</span>(<span style="color:#66d9ef">int</span> arg1, <span style="color:#66d9ef">int</span> arg2, <span style="color:#66d9ef">int</span> arg3) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> arg3;
</span></span><span style="display:flex;"><span>  a <span style="color:#f92672">-=</span> arg2;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> a;
</span></span><span style="display:flex;"><span>  b <span style="color:#f92672">=</span> b <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">0x1f</span>;
</span></span><span style="display:flex;"><span>  b <span style="color:#f92672">+=</span> a;
</span></span><span style="display:flex;"><span>  b <span style="color:#f92672">/=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>  b <span style="color:#f92672">+=</span> arg2;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (b <span style="color:#f92672">&gt;</span> arg1) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> mysterious(arg1, arg2, b <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">+=</span> c;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (b <span style="color:#f92672">&lt;</span> arg1) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> mysterious(arg1, b <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, arg3);
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">+=</span> c;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> b;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Since we know it must yield <code>0xa</code>, we can simply use this C function and find the right input: <code>3</code>.</p>
<p>The answer to phase 4 is then: <code>3 10</code>.</p>
<h3 id="phase-5">Phase 5</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">phase_5</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> *<span style="color:#66d9ef">s</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg const char *s @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_18h @ stack - 0x18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var uint64_t var_14h @ stack - 0x14
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_10h @ stack - 0x10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000017c4</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017c8</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x18</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017cc</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017d5</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017da</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017dc</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, [<span style="color:#66d9ef">var_14h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017e1</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">rsp</span>       <span style="color:#75715e">; va_list args
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000017e4</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">data.0000330f</span> <span style="color:#75715e">; 0x330f ; const char *format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000017eb</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__isoc99_sscanf</span> <span style="color:#75715e">; sym.imp.__isoc99_sscanf ; int sscanf(const char *s, const char *format, va_list args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000017f0</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017f3</span>      <span style="color:#66d9ef">jle</span> <span style="color:#ae81ff">0x184f</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017f5</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017f8</span>      <span style="color:#66d9ef">and</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0xf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017fb</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017fe</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0xf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001801</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1835</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001803</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">ecx</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001808</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edx</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000180d</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">data.000031c0</span> <span style="color:#75715e">; 0x31c0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001814</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">edx</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001817</span>      <span style="color:#66d9ef">cdqe</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001819</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span>*<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000181c</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000181e</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0xf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001821</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1814</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001823</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0xf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000182a</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">edx</span>, <span style="color:#ae81ff">0xf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000182d</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1835</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000182f</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_14h</span>], <span style="color:#66d9ef">ecx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001833</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x183a</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001835</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000183a</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000183f</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001848</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1856</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000184a</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x18</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000184e</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000184f</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001854</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x17f5</span>         <span style="color:#75715e">; phase_5+0x31
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001856</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__stack_chk_fail</span> <span style="color:#75715e">; sym.imp.__stack_chk_fail ; void __stack_chk_fail(void)
</span></span></span></code></pre></div><p>Quick notes:</p>
<ul>
<li><code>0x000017f0</code> - it expects at least two numbers</li>
<li><code>0x000017f5</code> to <code>0x00001801</code> - first argument least significant nibble must be less than <code>0xf</code></li>
<li><code>data.000031c0</code> is an array of numbers:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>0xa, 0x2, 0xe, 0x7, 0x8, 0xc, 0xf, 0xb, 0x0, 0x4, 0x1, 0xd, 0x3, 0x9, 0x6, 0x5
</span></span><span style="display:flex;"><span>  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15
</span></span></code></pre></div><p>Now, let’s look at the loop and the subsequent check:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000017f5</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001803</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">ecx</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001808</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edx</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000180d</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">data.000031c0</span> <span style="color:#75715e">; 0x31c0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001814</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">edx</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001817</span>      <span style="color:#66d9ef">cdqe</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001819</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span>*<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000181c</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000181e</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0xf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001821</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1814</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001823</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0xf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000182a</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">edx</span>, <span style="color:#ae81ff">0xf</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000182d</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1835</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000182f</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_14h</span>], <span style="color:#66d9ef">ecx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001833</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x183a</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001835</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span></code></pre></div><p>Here, we loop over the array, using <code>rax</code> as index, which is then set to the value found in the array.</p>
<p><code>ecx</code> is used to compute the sum of elements we looped through, and the loops stops when we hit the value <code>0xf</code>. The sum must then match our second argument (see <code>0x0000182f</code>).</p>
<p>On <code>0x0000182a</code>, we compare <code>edx</code>, which started at <code>0x1</code>, to be equal to <code>0xf</code>.</p>
<p>If start from the target end value, <code>0xf</code> at index 6, and only allow to loop <code>15 - 1</code> times we have the following sequence:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ae81ff">0xf</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0x6</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0xe</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0x2</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0x1</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0xa</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0x8</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0x4</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0x9</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0xd</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0xb</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0x7</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0x3</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0xc</span> <span style="color:#f92672">&lt;-</span> (<span style="color:#ae81ff">0x5</span>)
</span></span></code></pre></div><p>Therefore, the first index should be <code>5</code> and the sum is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">0xf</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x6</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0xe</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0xa</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x8</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x4</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0xd</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0xb</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x7</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x3</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0xc</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">115</span>
</span></span></code></pre></div><p>Phase 5 expects the answer: <code>5 115</code>.</p>
<h2 id="phase-6">Phase 6</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">phase_6</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_88h @ stack - 0x88
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_68h @ stack - 0x68
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_60h @ stack - 0x60
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_58h @ stack - 0x58
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_50h @ stack - 0x50
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_48h @ stack - 0x48
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_40h @ stack - 0x40
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; var int64_t var_30h @ stack - 0x30
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000185b</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000185f</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">r14</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001861</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">r13</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001863</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">r12</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001865</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001866</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001867</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x60</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000186b</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001874</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_30h</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001879</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000187b</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r13</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000187e</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">r13</span>       <span style="color:#75715e">; int arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001881</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">read_6_numbers</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001886</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r14d</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000188c</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r12</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000188f</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x18b9</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001891</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001896</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x18c8</span>         <span style="color:#75715e">; phase_6+0x6d
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001898</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000189c</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#ae81ff">5</span>         <span style="color:#75715e">; loop through next numbers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000189f</span>      <span style="color:#66d9ef">jg</span> <span style="color:#ae81ff">0x18b1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018a1</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">r12</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rbx</span>*<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018a5</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rbp</span>], <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018a8</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1898</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018aa</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018af</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1898</span>         <span style="color:#75715e">; phase_6+0x3d
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000018b1</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">r14</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018b5</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">r13</span>, <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018b9</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">r13</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018bc</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">r13</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018c0</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018c3</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">5</span>        
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x000018c6</span>      <span style="color:#66d9ef">ja</span> <span style="color:#ae81ff">0x1891</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018c8</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">r14d</span>, <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018cc</span>      <span style="color:#66d9ef">jg</span> <span style="color:#ae81ff">0x18d3</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018ce</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">r14</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018d1</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x18a1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018d3</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">esi</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018d8</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rsi</span>*<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018db</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018e0</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">data.00005200</span> <span style="color:#75715e">; 0x5200
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000018e7</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">ecx</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018ea</span>      <span style="color:#66d9ef">jle</span> <span style="color:#ae81ff">0x18f7</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018ec</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rdx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018f0</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018f3</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">ecx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018f5</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x18ec</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018f7</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rsi</span>*<span style="color:#ae81ff">8</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0x20</span>], <span style="color:#66d9ef">rdx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018fc</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001900</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001904</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x18d8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001906</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_68h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000190b</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_60h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001910</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001914</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_58h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001919</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rax</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>], <span style="color:#66d9ef">rdx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000191d</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_50h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001922</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rdx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001926</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_48h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000192b</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rax</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>], <span style="color:#66d9ef">rdx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000192f</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001934</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rdx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>], <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001938</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rax</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>], <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001940</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">ebp</span>, <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001945</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1950</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001947</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000194b</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">ebp</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000194e</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1961</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001950</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001954</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rax</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001956</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rbx</span>], <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001958</span>      <span style="color:#66d9ef">jge</span> <span style="color:#ae81ff">0x1947</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000195a</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000195f</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1947</span>         <span style="color:#75715e">; phase_6+0xec
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001961</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_30h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001966</span>      <span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">fs</span>:[<span style="color:#ae81ff">0x28</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000196f</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x197e</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001971</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x60</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001975</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001976</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001977</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">r12</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001979</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">r13</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000197b</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">r14</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000197d</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000197e</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__stack_chk_fail</span> <span style="color:#75715e">; sym.imp.__stack_chk_fail ; void __stack_chk_fail(void)
</span></span></span></code></pre></div><p>There is a call to <code>read_6_numbers</code> followed by an unconditional <code>jmp</code> where it checks that the first number is less than or equal to 6:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000187b</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r13</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000187e</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">r13</span>       <span style="color:#75715e">; int arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001881</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">read_6_numbers</span> <span style="color:#75715e">; read_6_numbers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001886</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r14d</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000188c</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r12</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000188f</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x18b9</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018b9</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">r13</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018bc</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">r13</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018c0</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018c3</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">5</span>        
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x000018c6</span>      <span style="color:#66d9ef">ja</span> <span style="color:#ae81ff">0x1891</span>
</span></span></code></pre></div><p>It then loops through the rest of the numbers and checks that the same value can’t be found, i.e. ensuring that it’s unique:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001898</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000189c</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">ebx</span>, <span style="color:#ae81ff">5</span>        
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x0000189f</span>      <span style="color:#66d9ef">jg</span> <span style="color:#ae81ff">0x18b1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018a1</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">r12</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rbx</span>*<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018a5</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rbp</span>], <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018a8</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1898</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018aa</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span></code></pre></div><p>and then moves to the next number:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018b1</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">r14</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018b5</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">r13</span>, <span style="color:#ae81ff">4</span>
</span></span></code></pre></div><p>It then loops over an array, using the 6 numbers like “indices”:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018d3</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">esi</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018d8</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rsp</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rsi</span>*<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018db</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018e0</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">data.00005200</span> <span style="color:#75715e">; 0x5200
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000018e7</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">ecx</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018ea</span>      <span style="color:#66d9ef">jle</span> <span style="color:#ae81ff">0x18f7</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018ec</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rdx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018f0</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018f3</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">ecx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018f5</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x18ec</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018f7</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rsi</span>*<span style="color:#ae81ff">8</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0x20</span>], <span style="color:#66d9ef">rdx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000018fc</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001900</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001904</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x18d8</span>
</span></span></code></pre></div><p>The data at <code>data.00005200</code> can be seen as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005110</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000200</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005114</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000006</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005118</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005200</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000212</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005204</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000001</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005208</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005210</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x00005210</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x000001c2</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005214</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000002</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005218</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005220</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x00005220</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000215</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005224</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000003</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005228</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005230</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x00005230</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000393</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005234</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000004</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005238</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005240</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x00005240</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x000003a7</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005244</span>      <span style="color:#66d9ef">.dword</span> <span style="color:#ae81ff">0x00000005</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005248</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005110</span>
</span></span></code></pre></div><p>This looks like a linked list! The code is actually traversing it to push the addresses on the stack, following the order provided by the input numbers.</p>
<p>Then, we compare values and expect to find them in decreasing order:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001940</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">ebp</span>, <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001945</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1950</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001947</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000194b</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">ebp</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000194e</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x1961</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001950</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rbx</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001954</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rax</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001956</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rbx</span>], <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001958</span>      <span style="color:#66d9ef">jge</span> <span style="color:#ae81ff">0x1947</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000195a</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate1</span>
</span></span></code></pre></div><p>Since the addresses are pushed on the stack via <code>mov qword [rsp + rsi*8 + 0x20], rdx</code>, we need to input <code>5 4 3 1 6 2</code> to defuse phase 6.</p>
<h3 id="secret-stage">Secret stage</h3>
<p>Let’s come back to the mysterious pieces we noticed in <code>check_completion</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dd4</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, [<span style="color:#66d9ef">var_74h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dd9</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, [<span style="color:#66d9ef">var_78h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001dde</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">r8</span>, [<span style="color:#66d9ef">var_70h</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001de3</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.d__d__s</span> <span style="color:#75715e">; 0x3359 ; const char *format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001dea</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">data.00005790</span> <span style="color:#75715e">; 0x5790 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001df1</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">__isoc99_sscanf</span> <span style="color:#75715e">; sym.imp.__isoc99_sscanf ; int sscanf(const char *s, const char *format, va_list args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001df6</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e09</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, [<span style="color:#66d9ef">var_70h</span>] <span style="color:#75715e">; int64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e0e</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">str.DrEvil</span> <span style="color:#75715e">; 0x3362 ; int64_t arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e15</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">strings_not_equal</span> <span style="color:#75715e">; strings_not_equal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e1a</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e1c</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1dfb</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e1e</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Curses__you_ve_found_the_secret_phase</span> <span style="color:#75715e">; 0x3238 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e25</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e2a</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.But_finding_it_and_solving_it_are_quite_different...</span> <span style="color:#75715e">; 0x3260 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e31</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001e36</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001e3b</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.000019c4</span>  <span style="color:#75715e">; fcn.000019c4
</span></span></span></code></pre></div><p>The function <code>fcn.000019c4</code> mentions a “secret stage”:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.000019c4</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a00</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Wow__You_ve_defused_the_secret_stage</span> <span style="color:#75715e">; 0x3178 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a07</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a0c</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">check_completion</span> <span style="color:#75715e">; check_completion
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><h4 id="entering-the-secret-stage">Entering the secret stage</h4>
<p>In order to enter the secret stage, we need to feed two numbers and the string <code>DrEvil</code> in <code>data.00005790</code>.</p>
<p>I couldn&rsquo;t find cross references to this specific location though.</p>
<p>Let’s come back to <code>read_line</code>, in particular on the first function it calls:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">read_line</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c56</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c5a</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c5e</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001c63</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001b93</span>  <span style="color:#75715e">; fcn.00001b93
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001c68</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.00001b93</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001b93</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b97</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b98</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b99</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001b9d</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">data.000056a0</span> <span style="color:#75715e">; 0x56a0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001ba4</span>      <span style="color:#66d9ef">movsxd</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">data.00005690</span> <span style="color:#75715e">; 0x5690
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001bab</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, [<span style="color:#66d9ef">rax</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span>*<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001baf</span>      <span style="color:#66d9ef">shl</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001bb3</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rbp</span>       <span style="color:#75715e">; char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001bb6</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">data.00005698</span> <span style="color:#75715e">; 0x5698 ; FILE *stream
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001bbd</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">esi</span>, <span style="color:#ae81ff">0x50</span>      <span style="color:#75715e">; &#39;P&#39; ; int size
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001bc2</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fgets</span>         <span style="color:#75715e">; sym.imp.fgets ; char *fgets(char *s, int size, FILE *stream)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><p>A quick calculation shows that <code>0x5790 = 0x56a0 + 0x50 * 3</code>. Which means that we can get in by squeezing the string <code>DrEvil</code> as a third input of phase 4:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ cat ans.txt    
</span></span><span style="display:flex;"><span>I am just a renegade hockey mom.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">8</span> <span style="color:#ae81ff">16</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">602</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span> <span style="color:#ae81ff">10</span> DrEvil
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span> <span style="color:#ae81ff">115</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>❯ ./bomb /tmp/ans.txt 
</span></span><span style="display:flex;"><span>Welcome to my fiendish little bomb. You have <span style="color:#ae81ff">6</span> phases with
</span></span><span style="display:flex;"><span>which to blow yourself up. Have a nice day!
</span></span><span style="display:flex;"><span>Phase <span style="color:#ae81ff">1</span> defused. How about the next one?
</span></span><span style="display:flex;"><span>That<span style="color:#e6db74">&#39;s number 2.  Keep going!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Halfway there!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">So you got that one.  Try this one.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Good work!  On to the next...
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Curses, you&#39;</span>ve found the secret phase!
</span></span><span style="display:flex;"><span>But finding it and solving it are quite different...
</span></span></code></pre></div><h4 id="solving-the-secret-stage">Solving the secret stage</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">secret_stage</span> ()<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019c4</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019c8</span>      <span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019c9</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">read_line</span>     <span style="color:#75715e">; read_line
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019ce</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>       <span style="color:#75715e">; const char *str
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019d1</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edx</span>, <span style="color:#ae81ff">0xa</span>       <span style="color:#75715e">; int base
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019d6</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">esi</span>, <span style="color:#ae81ff">0</span>         <span style="color:#75715e">; char **endptr
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019db</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">strtol</span>        <span style="color:#75715e">; sym.imp.strtol ; long strtol(const char *str, char **endptr, int base)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019e0</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019e3</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">rax</span> - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019e6</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">data.000003e8</span> <span style="color:#75715e">; 0x3e8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019eb</span>      <span style="color:#66d9ef">ja</span> <span style="color:#ae81ff">0x1a13</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019ed</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">esi</span>, <span style="color:#66d9ef">ebx</span>       <span style="color:#75715e">; int64_t arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019ef</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">data.00005120</span> <span style="color:#75715e">; 0x5120 ; int64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019f6</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001983</span>  <span style="color:#75715e">; fcn.00001983
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019fb</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019fe</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x1a1a</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a00</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">str.Wow__You_ve_defused_the_secret_stage</span> <span style="color:#75715e">; 0x3178 ; const char *s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a07</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">puts</span>          <span style="color:#75715e">; sym.imp.puts ; int puts(const char *s)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a0c</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">check_completion</span> <span style="color:#75715e">; check_completion
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a11</span>      <span style="color:#66d9ef">pop</span> <span style="color:#66d9ef">rbx</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a12</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a13</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a18</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x19ed</span>         <span style="color:#75715e">; secret_stage+0x29
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001a1a</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">detonate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001a1f</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x1a00</span>         <span style="color:#75715e">; secret_stage+0x3c
</span></span></span></code></pre></div><p>To defuse this one, we need <code>fcn.00001983</code> to return <code>0x5</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">fcn.00001983</span> (<span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg1</span>, <span style="color:#66d9ef">int64_t</span> <span style="color:#66d9ef">arg2</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg1 @ rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">; arg int64_t arg2 @ rsi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001983</span>      <span style="color:#66d9ef">endbr64</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001987</span>      <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rdi</span>      <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0000198a</span>      <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x19be</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000198c</span>      <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001990</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">edx</span>, <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">rdi</span>] <span style="color:#75715e">; arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001992</span>      <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">edx</span>, <span style="color:#66d9ef">esi</span>       <span style="color:#75715e">; arg2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00001994</span>      <span style="color:#66d9ef">jg</span> <span style="color:#ae81ff">0x19a2</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00001996</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000199b</span>      <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x19af</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000199d</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019a1</span>      <span style="color:#66d9ef">ret</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019a2</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rdi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">8</span>] <span style="color:#75715e">; int64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019a6</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001983</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019ab</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019ad</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x199d</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019af</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rdi</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">0x10</span>] <span style="color:#75715e">; int64_t arg1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019b3</span>      <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00001983</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019b8</span>      <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">rax</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">rax</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019bc</span>      <span style="color:#66d9ef">jmp</span> <span style="color:#ae81ff">0x199d</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000019be</span>      <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0xffffffff</span> <span style="color:#75715e">; -1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0x000019c3</span>      <span style="color:#66d9ef">ret</span>
</span></span></code></pre></div><p>It’s a recursive function, like in phase 4, so let’s write some C code again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">mysterious</span>(<span style="color:#66d9ef">int</span> arg1, <span style="color:#66d9ef">int</span> arg2) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (arg1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (arg1 <span style="color:#f92672">&lt;</span> arg2) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> mysterious(<span style="color:#f92672">*</span>(arg1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x10</span>), arg2) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">// right
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (arg1 <span style="color:#f92672">&gt;</span> arg2) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> mysterious(<span style="color:#f92672">*</span>(arg1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x8</span>), arg2); <span style="color:#75715e">// left
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// match
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>The second argument is our input whilst the first argument is given by <code>lea rdi, data.00005120</code> and points to some data. Given the function above, one can expect the data to be a bunch of nodes with:</p>
<ul>
<li>a value</li>
<li>an address (<code>arg1 + 0x8</code>)</li>
<li>another address (<code>arg1 + 0x10</code>)</li>
</ul>
<p>which sounds like a binary tree. Reshaping the data as such, we have:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005030</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000001</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005038</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005040</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005050</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000063</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005058</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005060</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005070</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000023</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005078</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005080</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005090</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000007</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005098</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050a0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050b0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000014</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050b8</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050c0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050d0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x000000000000002f</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050d8</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050e0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050f0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x00000000000003e9</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000050f8</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005100</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;-- data.00005120:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005120</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000024</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005128</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005140</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x00005130</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005160</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005140</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000008</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005148</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x00000000000051c0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005150</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005180</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005160</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000032</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005168</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x00000000000051a0</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x00005170</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x00000000000051e0</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005180</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000016</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00005188</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x00000000000050b0</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x00005190</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005070</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000051a0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x000000000000002d</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000051a8</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005010</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x000051b0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x00000000000050d0</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000051c0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000000006</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000051c8</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005030</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000051d0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005090</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000051e0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x000000000000006b</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x000051e8</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x0000000000005050</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0x000051f0</span>      <span style="color:#66d9ef">.qword</span> <span style="color:#ae81ff">0x00000000000050f0</span>
</span></span></code></pre></div><p>Since we need to reach <code>0x5 = 2 * (2 * (2 * (0) + 1)) + 1</code>, we must go right, left, and right, crossing the values: 24 → 32 → 45 → 47.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>But finding it and solving it are quite different...
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">47</span>
</span></span><span style="display:flex;"><span>Wow! You<span style="color:#e6db74">&#39;ve defused the secret stage!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Congratulations! You&#39;</span>ve defused the bomb!
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>I had a great time working through this lab!</p>
<p>The first 3 phases were quite straightforward, whilst the difficulty increased in the remaining phases. The hardest one was unequivocally phase 6 where I deeply missed <code>gdb/gef</code>! I was quite happy to finally solve it only using static analysis though.</p>
<p>I would definitely recommend this exercise to beginners willing to practice reverse engineering!</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://vthiery.github.io/tags/reverse-engineering/">reverse-engineering</a></span>
        <span class="tag"><a href="https://vthiery.github.io/tags/assembly/">assembly</a></span>
        <span class="tag"><a href="https://vthiery.github.io/tags/x86-64/">x86-64</a></span>
        <span class="tag"><a href="https://vthiery.github.io/tags/cutter/">cutter</a></span>
        <span class="tag"><a href="https://vthiery.github.io/tags/write-up/">write-up</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        6397 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2023-07-12 00:00
        

         
          
        
      </p>
    </div>

    

    

    

  </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2d3d449fc0ff117f00ac91342a8f76cd5b710411d7a0254dbe75da3234d2f685d6a0c44cff60c414e90b6a149da8e4032c713c25e4e6838e2e3918dc0ad2e81c.js" integrity="sha512-LT1En8D/EX8ArJE0Ko92zVtxBBHXoCVNvnXaMjTS9oXWoMRM/2DEFOkLahSdqOQDLHE8JeTmg44uORjcCtLoHA=="></script>



    </body>
</html>
